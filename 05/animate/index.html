<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŠ¨ç”»åˆ†é•œç®¡ç†å¹³å°</title>
    <style>
        :root {
            --bg-color: #1e1e1e;
            --sidebar-width: 350px;
            --primary-color: #61dafb;
            --text-color: #f0f0f0;
            --border-color: #333;
            --card-bg: #2d2d2d;
            --highlight-bg: #3a3a3a;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            height: 100vh;
            display: flex;
            overflow: hidden;
        }

        /* å¸ƒå±€ */
        .sidebar {
            width: var(--sidebar-width);
            border-right: 1px solid var(--border-color);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            overflow-y: auto;
        }

        /* ä¾§è¾¹æ åˆ—è¡¨ */
        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            font-weight: bold;
            font-size: 1.2em;
            color: var(--primary-color);
        }

        .scene-group {
            padding: 10px 20px;
            font-size: 0.85em;
            color: #888;
            text-transform: uppercase;
            margin-top: 10px;
        }

        .scene-item {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: background 0.2s;
        }

        .scene-item:hover {
            background: var(--highlight-bg);
        }

        .scene-item.active {
            background: #2c3e50;
            border-left: 4px solid var(--primary-color);
        }

        .scene-title {
            font-weight: 500;
        }

        .scene-meta {
            font-size: 0.8em;
            color: #aaa;
            margin-top: 5px;
        }

        /* ä¸»å†…å®¹: è§†é¢‘åŒº */
        .video-container {
            width: 100%;
            background: #000;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 20px;
            position: relative;
            min-height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        video {
            width: 100%;
            max-height: 60vh;
            outline: none;
        }

        .placeholder {
            color: #555;
        }

        /* ä¸»å†…å®¹: è¯¦æƒ…åŒº */
        .details-container {
            display: flex;
            gap: 20px;
            flex: 1;
        }

        .desc-box,
        .code-box {
            flex: 1;
            background: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            overflow-y: auto;
            max-height: 400px;
        }

        h3 {
            margin-top: 0;
            color: var(--primary-color);
            border-bottom: 1px solid #444;
            padding-bottom: 10px;
            font-size: 1em;
        }

        /* ä»£ç æ˜¾ç¤º */
        pre {
            white-space: pre-wrap;
            word-break: break-all;
            font-family: 'Consolas', monospace;
            font-size: 0.9em;
            color: #d4d4d4;
            margin: 0;
        }

        /* Copy button */
        .cmd-display {
            background: #000;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            color: #0f0;
            margin-bottom: 15px;
            cursor: pointer;
            font-size: 0.9em;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-track {
            background: #222;
        }
    </style>
</head>

<body>

    <!-- å·¦ä¾§åˆ—è¡¨ -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">ğŸ¬ åŠ¨ç”»åˆ†é•œåˆ—è¡¨</div>
        <!-- List Items injected by JS -->
        <div style="padding: 20px; color: #666;">åŠ è½½ä¸­...</div>
    </div>

    <!-- å³ä¾§è¯¦æƒ… -->
    <div class="main-content" id="main">
        <!-- ä¸Šéƒ¨ï¼šè§†é¢‘ -->
        <div class="video-container">
            <div class="placeholder" id="video-placeholder">è¯·åœ¨å·¦ä¾§é€‰æ‹©åˆ†é•œ</div>
            <video id="player" controls style="display: none;">
                <source src="" type="video/mp4">
                æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘æ’­æ”¾ã€‚
            </video>
        </div>

        <!-- å‘½ä»¤æ  -->
        <div id="cmd-bar" class="cmd-display" onclick="copyCmd()" style="display:none;" title="ç‚¹å‡»å¤åˆ¶å‘½ä»¤">
            Render Command
        </div>

        <!-- ä¸‹éƒ¨ï¼šè¯¦æƒ… (æè¿° + ä»£ç ) -->
        <div class="details-container">
            <div class="desc-box">
                <h3>ğŸ“œ è„šæœ¬æè¿°</h3>
                <p id="desc-text" style="line-height: 1.6; color: #ccc;">...</p>
            </div>
            <div class="code-box">
                <h3>ğŸ’» å¯¹åº”ä»£ç </h3>
                <pre><code id="code-content">...</code></pre>
            </div>
        </div>
    </div>

    <script>
        let currentScenes = [];

        // åˆå§‹åŒ–
        async function init() {
            try {
                const res = await fetch('/api/scenes');
                const scenes = await res.json();
                currentScenes = scenes;
                renderSidebar(scenes);

                // é»˜è®¤é€‰æ‹©ç¬¬ä¸€ä¸ª
                if (scenes.length > 0) {
                    selectScene(scenes[0].id);
                }
            } catch (e) {
                console.error(e);
                document.getElementById('sidebar').innerHTML = '<div style="padding:20px; color:red">åŠ è½½å¤±è´¥ï¼Œè¯·ç¡®ä¿æœåŠ¡å™¨å·²å¯åŠ¨ (python server.py)</div>';
            }
        }

        // æ¸²æŸ“åˆ—è¡¨
        function renderSidebar(scenes) {
            const container = document.getElementById('sidebar');
            container.innerHTML = '<div class="sidebar-header">ğŸ¬ åŠ¨ç”»åˆ†é•œåˆ—è¡¨</div>';

            let lastGroup = "";

            scenes.forEach(scene => {
                if (scene.group !== lastGroup) {
                    const groupDiv = document.createElement('div');
                    groupDiv.className = 'scene-group';
                    groupDiv.innerText = scene.group;
                    container.appendChild(groupDiv);
                    lastGroup = scene.group;
                }

                const item = document.createElement('div');
                item.className = 'scene-item';
                item.id = `item-${scene.id}`;
                item.onclick = () => selectScene(scene.id);
                item.innerHTML = `
                    <div class="scene-title">${scene.title}</div>
                    <div class="scene-meta">${scene.scene_class}</div>
                `;
                container.appendChild(item);
            });
        }

        // é€‰æ‹©åˆ†é•œ
        async function selectScene(id) {
            // UI Highlight
            document.querySelectorAll('.scene-item').forEach(el => el.classList.remove('active'));
            const activeItem = document.getElementById(`item-${id}`);
            if (activeItem) activeItem.classList.add('active');

            const scene = currentScenes.find(s => s.id === id);
            if (!scene) return;

            // 1. Update Video
            const player = document.getElementById('player');
            const placeholder = document.getElementById('video-placeholder');

            // Check if video file "likely" exists (client side guess or just try loading)
            // In a real app we might check status, here we just set src
            player.src = scene.video_path;
            player.style.display = 'block';
            placeholder.style.display = 'none';
            // player.play(); // Auto play optional

            // 2. Update Description
            document.getElementById('desc-text').innerText = scene.desc;

            // 3. Update Command
            const cmdDiv = document.getElementById('cmd-bar');
            cmdDiv.style.display = 'block';
            cmdDiv.innerText = `uv run manim -pql ${scene.code_path} ${scene.scene_class}`;

            // 4. Fetch Code
            const codeEl = document.getElementById('code-content');
            codeEl.innerText = "æ­£åœ¨åŠ è½½ä»£ç ...";
            try {
                const res = await fetch(`/api/code?path=${encodeURIComponent(scene.code_path)}`);
                if (res.ok) {
                    const data = await res.json();
                    codeEl.innerText = data.content;
                } else {
                    codeEl.innerText = "æ— æ³•è¯»å–ä»£ç æ–‡ä»¶";
                }
            } catch (e) {
                codeEl.innerText = "è¯·æ±‚é”™è¯¯";
            }
        }

        function copyCmd() {
            const text = document.getElementById('cmd-bar').innerText;
            navigator.clipboard.writeText(text).then(() => {
                alert("å‘½ä»¤å·²å¤åˆ¶");
            });
        }

        init();
    </script>
</body>

</html>